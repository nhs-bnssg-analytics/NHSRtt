<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Visualising projections â€¢ NHSRtt</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Visualising projections">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NHSRtt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/rtt-pipeline.html">Creating and validating a model</a></li>
    <li><a class="dropdown-item" href="../articles/animated-charts.html">Visualising projections</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Visualising projections</h1>
            
      

      <div class="d-none name"><code>animated-charts.Rmd</code></div>
    </div>

    
    
<p>A proven effective way of presenting the outputs from waiting list
projections is using animated charts. These can be embedded in many
documents, including htmls and powerpoint files. This vignette shows how
to generate the charts from the functions provided in the NHSRtt
package.</p>
<p>The following libraries are needed for this vignette:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nhs-bnssg-analytics.github.io/NHSRtt/">NHSRtt</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">#&gt;   object 'type_sum.accel' not found</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/" class="external-link">forecast</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="create-the-input-data">Create the input data<a class="anchor" aria-label="anchor" href="#create-the-input-data"></a>
</h2>
<p>The data used here is dummy data. The calibration period here is two
years, and the forecast period is also two years. Validation is not
performed here because the purpose of this vignette is simply to show
how to create animations.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">max_months_waited</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">calibration_periods</span> <span class="op">&lt;-</span> <span class="fl">24</span></span>
<span><span class="va">seed</span> <span class="op">&lt;-</span> <span class="fl">599</span></span></code></pre></div>
<div class="section level3">
<h3 id="calibration">Calibration<a class="anchor" aria-label="anchor" href="#calibration"></a>
</h3>
<p>The calibration data are created and passed to the
<code><a href="../reference/calibrate_capacity_renege_params.html">calibrate_capacity_renege_params()</a></code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">referrals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dummy_data.html">create_dummy_data</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"referrals"</span>,</span>
<span>  max_months_waited <span class="op">=</span> <span class="va">max_months_waited</span>,</span>
<span>  number_periods <span class="op">=</span> <span class="va">calibration_periods</span>,</span>
<span>  referral_values <span class="op">=</span> <span class="fl">500</span><span class="op">:</span><span class="fl">600</span>,</span>
<span>  seed <span class="op">=</span> <span class="va">seed</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">incompletes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dummy_data.html">create_dummy_data</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"incompletes"</span>,</span>
<span>  max_months_waited <span class="op">=</span> <span class="va">max_months_waited</span>,</span>
<span>  number_periods <span class="op">=</span> <span class="va">calibration_periods</span>,</span>
<span>  max_incompletes <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  seed <span class="op">=</span> <span class="va">seed</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">completes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dummy_data.html">create_dummy_data</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"completes"</span>,</span>
<span>  max_months_waited <span class="op">=</span> <span class="va">max_months_waited</span>,</span>
<span>  number_periods <span class="op">=</span> <span class="va">calibration_periods</span>,</span>
<span>  max_treatments <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  seed <span class="op">=</span> <span class="va">seed</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calibrate_capacity_renege_params.html">calibrate_capacity_renege_params</a></span><span class="op">(</span></span>
<span>  referrals <span class="op">=</span> <span class="va">referrals</span>,</span>
<span>  incompletes <span class="op">=</span> <span class="va">incompletes</span>,</span>
<span>  completes <span class="op">=</span> <span class="va">completes</span>,</span>
<span>  max_months_waited <span class="op">=</span> <span class="va">max_months_waited</span>,</span>
<span>  redistribute_m0_reneges <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="projections---input-data">Projections - input data<a class="anchor" aria-label="anchor" href="#projections---input-data"></a>
</h3>
<p>When projecting, it is good to have a variety of projections
representing more and less severe scenarios. One way of projecting is
using a time series method, such as ARIMA or TBATS. Here we show how to
use TBATS, along with the uncertainty that is provided by the
function.</p>
<p>For simplicity, the calibration data is re-used as projection data.
The inputs to the function are 24 months of referrals, 24 months of
treatments (completed pathways) and incomplete pathways for 1 time
period.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timesteps</span> <span class="op">&lt;-</span> <span class="fl">24</span></span>
<span></span>
<span><span class="co"># this function helps with repeated data manipulation; it contains the ts</span></span>
<span><span class="co"># function (which turns the data into a time series - where the 12 indicates</span></span>
<span><span class="co"># that is it a monthly time series), and also the tbats function, which performs</span></span>
<span><span class="co"># the time series analysis on the time series</span></span>
<span><span class="va">forecast_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rtt_table</span>, <span class="va">number_timesteps</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fcast</span> <span class="op">&lt;-</span> <span class="va">rtt_table</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span>frequency <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/tbats.html" class="external-link">tbats</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number_timesteps</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">fcast</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">projection_referrals</span> <span class="op">&lt;-</span> <span class="va">referrals</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    value <span class="op">=</span> <span class="va">referrals</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">forecast_function</span><span class="op">(</span></span>
<span>    number_timesteps <span class="op">=</span> <span class="va">timesteps</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"Referrals"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This creates a table that looks like this (only the top 15 rows are
displayed). This table contains uncertainty in the projections.</p>
<table class="table">
<thead><tr class="header">
<th align="right">Point Forecast</th>
<th align="right">Lo 80</th>
<th align="right">Hi 80</th>
<th align="right">Lo 95</th>
<th align="right">Hi 95</th>
<th align="left">type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">553.3873</td>
<td align="right">525.5815</td>
<td align="right">581.1932</td>
<td align="right">510.8620</td>
<td align="right">595.9127</td>
<td align="left">Referrals</td>
</tr>
<tr class="even">
<td align="right">553.8094</td>
<td align="right">525.8679</td>
<td align="right">581.7509</td>
<td align="right">511.0766</td>
<td align="right">596.5422</td>
<td align="left">Referrals</td>
</tr>
<tr class="odd">
<td align="right">554.1981</td>
<td align="right">526.1424</td>
<td align="right">582.2539</td>
<td align="right">511.2905</td>
<td align="right">597.1058</td>
<td align="left">Referrals</td>
</tr>
<tr class="even">
<td align="right">554.5562</td>
<td align="right">526.4040</td>
<td align="right">582.7083</td>
<td align="right">511.5012</td>
<td align="right">597.6112</td>
<td align="left">Referrals</td>
</tr>
<tr class="odd">
<td align="right">554.8859</td>
<td align="right">526.6525</td>
<td align="right">583.1193</td>
<td align="right">511.7066</td>
<td align="right">598.0652</td>
<td align="left">Referrals</td>
</tr>
<tr class="even">
<td align="right">555.1896</td>
<td align="right">526.8876</td>
<td align="right">583.4916</td>
<td align="right">511.9055</td>
<td align="right">598.4738</td>
<td align="left">Referrals</td>
</tr>
<tr class="odd">
<td align="right">555.4693</td>
<td align="right">527.1095</td>
<td align="right">583.8292</td>
<td align="right">512.0967</td>
<td align="right">598.8420</td>
<td align="left">Referrals</td>
</tr>
<tr class="even">
<td align="right">555.7270</td>
<td align="right">527.3183</td>
<td align="right">584.1356</td>
<td align="right">512.2797</td>
<td align="right">599.1743</td>
<td align="left">Referrals</td>
</tr>
<tr class="odd">
<td align="right">555.9642</td>
<td align="right">527.5144</td>
<td align="right">584.4141</td>
<td align="right">512.4539</td>
<td align="right">599.4745</td>
<td align="left">Referrals</td>
</tr>
<tr class="even">
<td align="right">556.1828</td>
<td align="right">527.6981</td>
<td align="right">584.6674</td>
<td align="right">512.6193</td>
<td align="right">599.7462</td>
<td align="left">Referrals</td>
</tr>
<tr class="odd">
<td align="right">556.3840</td>
<td align="right">527.8701</td>
<td align="right">584.8980</td>
<td align="right">512.7757</td>
<td align="right">599.9924</td>
<td align="left">Referrals</td>
</tr>
<tr class="even">
<td align="right">556.5694</td>
<td align="right">528.0307</td>
<td align="right">585.1081</td>
<td align="right">512.9232</td>
<td align="right">600.2156</td>
<td align="left">Referrals</td>
</tr>
<tr class="odd">
<td align="right">556.7401</td>
<td align="right">528.1806</td>
<td align="right">585.2997</td>
<td align="right">513.0620</td>
<td align="right">600.4182</td>
<td align="left">Referrals</td>
</tr>
<tr class="even">
<td align="right">556.8974</td>
<td align="right">528.3202</td>
<td align="right">585.4746</td>
<td align="right">513.1924</td>
<td align="right">600.6024</td>
<td align="left">Referrals</td>
</tr>
<tr class="odd">
<td align="right">557.0422</td>
<td align="right">528.4502</td>
<td align="right">585.6342</td>
<td align="right">513.3145</td>
<td align="right">600.7699</td>
<td align="left">Referrals</td>
</tr>
</tbody>
</table>
<p>This is repeated for the number of treatments and the incomplete
pathways.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">projection_complete</span> <span class="op">&lt;-</span> <span class="va">completes</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">treatments</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">period_id</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">forecast_function</span><span class="op">(</span></span>
<span>    number_timesteps <span class="op">=</span> <span class="va">timesteps</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"Treatments"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">projection_incomplete</span> <span class="op">&lt;-</span> <span class="va">incompletes</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    value <span class="op">=</span> <span class="va">incompletes</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">months_waited_id</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html" class="external-link">group_split</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>    <span class="va">forecast_function</span>,</span>
<span>    number_timesteps <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span>nm <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"months_waited_id"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    months_waited_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">months_waited_id</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>These inputs can be turned into scenarios. The more severe scenarios
would be those with higher incomplete pathways and higher referrals
combined with lower completed pathways. The less severe scenarios would
be the opposite.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># most severe (severe_1)</span></span>
<span></span>
<span><span class="va">severe_1_referrals</span> <span class="op">&lt;-</span> <span class="va">projection_referrals</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">`Hi 95`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">severe_1_treatments</span> <span class="op">&lt;-</span> <span class="va">projection_complete</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">`Lo 95`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">severe_1_incomplete</span> <span class="op">&lt;-</span> <span class="va">projection_incomplete</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="st">"months_waited_id"</span>,</span>
<span>    incompletes <span class="op">=</span> <span class="st">"Hi 95"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># 2nd most severe (severe_2)</span></span>
<span></span>
<span><span class="va">severe_2_referrals</span> <span class="op">&lt;-</span> <span class="va">projection_referrals</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">`Hi 80`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">severe_2_treatments</span> <span class="op">&lt;-</span> <span class="va">projection_complete</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">`Lo 80`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">severe_2_incomplete</span> <span class="op">&lt;-</span> <span class="va">projection_incomplete</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="st">"months_waited_id"</span>,</span>
<span>    incompletes <span class="op">=</span> <span class="st">"Hi 80"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># average</span></span>
<span></span>
<span><span class="va">average_referrals</span> <span class="op">&lt;-</span> <span class="va">projection_referrals</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">`Point Forecast`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">average_treatments</span> <span class="op">&lt;-</span> <span class="va">projection_complete</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">`Point Forecast`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">average_incomplete</span> <span class="op">&lt;-</span> <span class="va">projection_incomplete</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="st">"months_waited_id"</span>,</span>
<span>    incompletes <span class="op">=</span> <span class="st">"Point Forecast"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># 2nd mildest (mild_2)</span></span>
<span></span>
<span><span class="va">mild_2_referrals</span> <span class="op">&lt;-</span> <span class="va">projection_referrals</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">`Lo 80`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mild_2_treatments</span> <span class="op">&lt;-</span> <span class="va">projection_complete</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">`Hi 80`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mild_2_incomplete</span> <span class="op">&lt;-</span> <span class="va">projection_incomplete</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="st">"months_waited_id"</span>,</span>
<span>    incompletes <span class="op">=</span> <span class="st">"Lo 80"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Mildest (mild_1)</span></span>
<span></span>
<span><span class="va">mild_1_referrals</span> <span class="op">&lt;-</span> <span class="va">projection_referrals</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">`Lo 95`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mild_1_treatments</span> <span class="op">&lt;-</span> <span class="va">projection_complete</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">`Hi 95`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mild_1_incomplete</span> <span class="op">&lt;-</span> <span class="va">projection_incomplete</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="st">"months_waited_id"</span>,</span>
<span>    incompletes <span class="op">=</span> <span class="st">"Lo 95"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="projections---forecasts">Projections - forecasts<a class="anchor" aria-label="anchor" href="#projections---forecasts"></a>
</h3>
<p>The inputs are passed to the
<code><a href="../reference/apply_params_to_projections.html">apply_params_to_projections()</a></code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">severe_1_projections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_params_to_projections.html">apply_params_to_projections</a></span><span class="op">(</span></span>
<span>  capacity_projections <span class="op">=</span> <span class="va">severe_1_treatments</span>,</span>
<span>  referrals_projections <span class="op">=</span> <span class="va">severe_1_referrals</span>,</span>
<span>  incomplete_pathways <span class="op">=</span> <span class="va">severe_1_incomplete</span>,</span>
<span>  renege_capacity_params <span class="op">=</span> <span class="va">params</span>,</span>
<span>  max_months_waited <span class="op">=</span> <span class="va">max_months_waited</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    scenario <span class="op">=</span> <span class="st">"Most severe"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">severe_2_projections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_params_to_projections.html">apply_params_to_projections</a></span><span class="op">(</span></span>
<span>  capacity_projections <span class="op">=</span> <span class="va">severe_2_treatments</span>,</span>
<span>  referrals_projections <span class="op">=</span> <span class="va">severe_2_referrals</span>,</span>
<span>  incomplete_pathways <span class="op">=</span> <span class="va">severe_2_incomplete</span>,</span>
<span>  renege_capacity_params <span class="op">=</span> <span class="va">params</span>,</span>
<span>  max_months_waited <span class="op">=</span> <span class="va">max_months_waited</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    scenario <span class="op">=</span> <span class="st">"2nd most severe"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">average_projections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_params_to_projections.html">apply_params_to_projections</a></span><span class="op">(</span></span>
<span>  capacity_projections <span class="op">=</span> <span class="va">average_treatments</span>,</span>
<span>  referrals_projections <span class="op">=</span> <span class="va">average_referrals</span>,</span>
<span>  incomplete_pathways <span class="op">=</span> <span class="va">average_incomplete</span>,</span>
<span>  renege_capacity_params <span class="op">=</span> <span class="va">params</span>,</span>
<span>  max_months_waited <span class="op">=</span> <span class="va">max_months_waited</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    scenario <span class="op">=</span> <span class="st">"Average"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">mild_2_projections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_params_to_projections.html">apply_params_to_projections</a></span><span class="op">(</span></span>
<span>  capacity_projections <span class="op">=</span> <span class="va">mild_2_treatments</span>,</span>
<span>  referrals_projections <span class="op">=</span> <span class="va">mild_2_referrals</span>,</span>
<span>  incomplete_pathways <span class="op">=</span> <span class="va">mild_2_incomplete</span>,</span>
<span>  renege_capacity_params <span class="op">=</span> <span class="va">params</span>,</span>
<span>  max_months_waited <span class="op">=</span> <span class="va">max_months_waited</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    scenario <span class="op">=</span> <span class="st">"2nd mildest"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">mild_1_projections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_params_to_projections.html">apply_params_to_projections</a></span><span class="op">(</span></span>
<span>  capacity_projections <span class="op">=</span> <span class="va">mild_1_treatments</span>,</span>
<span>  referrals_projections <span class="op">=</span> <span class="va">mild_1_referrals</span>,</span>
<span>  incomplete_pathways <span class="op">=</span> <span class="va">mild_1_incomplete</span>,</span>
<span>  renege_capacity_params <span class="op">=</span> <span class="va">params</span>,</span>
<span>  max_months_waited <span class="op">=</span> <span class="va">max_months_waited</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    scenario <span class="op">=</span> <span class="st">"Mildest"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="visualisations">Visualisations<a class="anchor" aria-label="anchor" href="#visualisations"></a>
</h2>
<div class="section level3">
<h3 id="inputs">Inputs<a class="anchor" aria-label="anchor" href="#inputs"></a>
</h3>
<p>Stakeholders are often interested in the inputs to understand the
outputs better. These sections give some useful code for styling the
data used in bespoke analysis.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pal_bands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">'Middle'</span> <span class="op">=</span> <span class="st">'#6baed6'</span>,</span>
<span>  <span class="st">'Inner'</span> <span class="op">=</span> <span class="st">'#08519c'</span>,</span>
<span>  <span class="st">'Median'</span> <span class="op">=</span> <span class="st">'#FFFFFF'</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">projection_complete</span>,</span>
<span>  <span class="va">projection_referrals</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    period_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">type</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">period_id</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      ymin <span class="op">=</span> <span class="va">`Lo 80`</span>, </span>
<span>      ymax <span class="op">=</span> <span class="va">`Hi 80`</span>, </span>
<span>      fill <span class="op">=</span> <span class="st">'Middle'</span></span>
<span>    <span class="op">)</span>, </span>
<span>    alpha <span class="op">=</span> <span class="fl">0.6</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      ymin <span class="op">=</span> <span class="va">`Lo 95`</span>, </span>
<span>      ymax <span class="op">=</span> <span class="va">`Hi 95`</span>, </span>
<span>      fill <span class="op">=</span> <span class="st">'Inner'</span></span>
<span>    <span class="op">)</span>, </span>
<span>    alpha <span class="op">=</span> <span class="fl">0.6</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      ymin <span class="op">=</span> <span class="va">`Point Forecast`</span>, </span>
<span>      ymax <span class="op">=</span> <span class="va">`Point Forecast`</span>, </span>
<span>      fill <span class="op">=</span> <span class="st">'Median'</span></span>
<span>    <span class="op">)</span>, </span>
<span>    color <span class="op">=</span> <span class="st">'black'</span>, </span>
<span>  alpha <span class="op">=</span> <span class="fl">0.6</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      y <span class="op">=</span> <span class="va">`Point Forecast`</span>,</span>
<span>      group <span class="op">=</span> <span class="va">type</span></span>
<span>    <span class="op">)</span>, </span>
<span>    color <span class="op">=</span> <span class="st">'white'</span>, </span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span></span>
<span>    facets <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span>,</span>
<span>    scales <span class="op">=</span> <span class="st">"free_y"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Input range of completes pathways and referrals by period"</span>, </span>
<span>    x <span class="op">=</span> <span class="st">"Period"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Volume"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Interval"</span>, </span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Middle'</span>, <span class="st">'Inner'</span>, <span class="st">'Median'</span><span class="op">)</span>,</span>
<span>    values <span class="op">=</span> <span class="va">pal_bands</span>, </span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">'Middle'</span> <span class="op">=</span> <span class="st">'10% to 90%'</span>, </span>
<span>      <span class="st">'Inner'</span> <span class="op">=</span> <span class="st">'2.5% to 97.5%'</span>, </span>
<span>      <span class="st">'Median'</span> <span class="op">=</span> <span class="st">'Median'</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="animated-charts_files/figure-html/visualise-inputs-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="static-projections">Static projections<a class="anchor" aria-label="anchor" href="#static-projections"></a>
</h2>
<p>A similar set of charts can be made for the waiting list
projections.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">mild_1_projections</span>,</span>
<span>  <span class="va">mild_2_projections</span>,</span>
<span>  <span class="va">average_projections</span>,</span>
<span>  <span class="va">severe_2_projections</span>,</span>
<span>  <span class="va">severe_1_projections</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="st">"period_id"</span>, <span class="st">"months_waited_id"</span>, <span class="st">"incompletes"</span>, <span class="st">"scenario"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">scenario</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">incompletes</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    <span class="st">"Lo 80"</span> <span class="op">=</span> <span class="st">"Mildest"</span>,</span>
<span>    <span class="st">"Lo 95"</span> <span class="op">=</span> <span class="st">"2nd mildest"</span>,</span>
<span>    <span class="st">"Median"</span> <span class="op">=</span> <span class="st">"Average"</span>,</span>
<span>    <span class="st">"Hi 95"</span> <span class="op">=</span> <span class="st">"2nd most severe"</span>,</span>
<span>    <span class="st">"Hi 80"</span> <span class="op">=</span> <span class="st">"Most severe"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    months_waited_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>      <span class="va">months_waited_id</span>,</span>
<span>      <span class="st">"months waited"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    months_waited_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">months_waited_id</span>,</span>
<span>      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">12</span>, <span class="st">"months waited"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">period_id</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      ymin <span class="op">=</span> <span class="va">`Lo 80`</span>, </span>
<span>      ymax <span class="op">=</span> <span class="va">`Hi 80`</span>, </span>
<span>      fill <span class="op">=</span> <span class="st">'Middle'</span></span>
<span>    <span class="op">)</span>, </span>
<span>    alpha <span class="op">=</span> <span class="fl">0.6</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      ymin <span class="op">=</span> <span class="va">`Lo 95`</span>, </span>
<span>      ymax <span class="op">=</span> <span class="va">`Hi 95`</span>, </span>
<span>      fill <span class="op">=</span> <span class="st">'Inner'</span></span>
<span>    <span class="op">)</span>, </span>
<span>    alpha <span class="op">=</span> <span class="fl">0.6</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      ymin <span class="op">=</span> <span class="va">`Median`</span>, </span>
<span>      ymax <span class="op">=</span> <span class="va">`Median`</span>, </span>
<span>      fill <span class="op">=</span> <span class="st">'Median'</span></span>
<span>    <span class="op">)</span>, </span>
<span>    color <span class="op">=</span> <span class="st">'black'</span>, </span>
<span>  alpha <span class="op">=</span> <span class="fl">0.6</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      y <span class="op">=</span> <span class="va">`Median`</span>,</span>
<span>      group <span class="op">=</span> <span class="va">months_waited_id</span></span>
<span>    <span class="op">)</span>, </span>
<span>    color <span class="op">=</span> <span class="st">'white'</span>, </span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span></span>
<span>    facets <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">months_waited_id</span><span class="op">)</span>,</span>
<span>    scales <span class="op">=</span> <span class="st">"free_y"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Incomplete pathways by wait time"</span>, </span>
<span>    x <span class="op">=</span> <span class="st">"Period"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Volume"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Interval"</span>, </span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Middle'</span>, <span class="st">'Inner'</span>, <span class="st">'Median'</span><span class="op">)</span>,</span>
<span>    values <span class="op">=</span> <span class="va">pal_bands</span>, </span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">'Middle'</span> <span class="op">=</span> <span class="st">'10% to 90%'</span>, </span>
<span>      <span class="st">'Inner'</span> <span class="op">=</span> <span class="st">'2.5% to 97.5%'</span>, </span>
<span>      <span class="st">'Median'</span> <span class="op">=</span> <span class="st">'Median'</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="animated-charts_files/figure-html/static-projections-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="animated-projections">Animated projections<a class="anchor" aria-label="anchor" href="#animated-projections"></a>
</h2>
<p>This can also be displayed as a rolling animation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">mild_1_projections</span>,</span>
<span>  <span class="va">mild_2_projections</span>,</span>
<span>  <span class="va">average_projections</span>,</span>
<span>  <span class="va">severe_2_projections</span>,</span>
<span>  <span class="va">severe_1_projections</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="st">"period_id"</span>, <span class="st">"months_waited_id"</span>, <span class="st">"incompletes"</span>, <span class="st">"scenario"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    scenario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">scenario</span>,</span>
<span>      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Mildest"</span>,</span>
<span>        <span class="st">"2nd mildest"</span>,</span>
<span>        <span class="st">"Average"</span>,</span>
<span>        <span class="st">"2nd most severe"</span>,</span>
<span>        <span class="st">"Most severe"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    period_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">period_id</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">months_waited_id</span>,</span>
<span>      y <span class="op">=</span> <span class="va">incompletes</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      group <span class="op">=</span> <span class="va">period_id</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#08519c"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Incomplete pathways by number of months waited: period {frame_time}"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Number of months waited"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of incompete pathways"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span></span>
<span>    facets <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">scenario</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html" class="external-link">transition_time</a></span><span class="op">(</span></span>
<span>    <span class="va">period_id</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="animated-charts_files/figure-html/animated-projections-1.gif"><!-- --></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Fox, Richard Wood, Richard Blackwell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
